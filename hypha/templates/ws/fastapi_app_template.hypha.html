<config lang="json">
{
    "name": "FastAPI Web App",
    "type": "web-python",
    "version": "0.1.0",
    "description": "A modern FastAPI web application with elegant styling and interactive features.",
    "tags": ["web", "api", "fastapi", "modern"],
    "ui": "",
    "cover": "",
    "icon": "üöÄ",
    "api_version": "0.1.8",
    "requirements": ["fastapi==0.112.1"],
    "dependencies": [],
    "startup_config": {
        "timeout": 60,
        "wait_for_service": "hello-fastapi",
        "stop_after_inactive": 600
    }
}
</config>

<script lang="python">
from hypha_rpc import api
from fastapi import FastAPI, HTTPException
from fastapi.responses import HTMLResponse
import time
import json
from datetime import datetime

def create_fastapi_app():
    app = FastAPI(
        title="Modern FastAPI App",
        description="A stylish FastAPI application with interactive features",
        version="1.0.0"
    )

    @app.get("/", response_class=HTMLResponse)
    async def home():
        current_time = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        return f"""
        <!DOCTYPE html>
        <html>
        <head>
            <title>Modern FastAPI App</title>
            <style>
                body {{
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
                    line-height: 1.6;
                    color: #333;
                    max-width: 800px;
                    margin: 0 auto;
                    padding: 20px;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    min-height: 100vh;
                }}
                .container {{
                    background: white;
                    padding: 40px;
                    border-radius: 15px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                    margin: 20px 0;
                }}
                .header {{
                    text-align: center;
                    margin-bottom: 30px;
                }}
                .header h1 {{
                    color: #2c3e50;
                    margin: 0;
                    font-size: 2.5em;
                }}
                .subtitle {{
                    color: #7f8c8d;
                    margin: 10px 0;
                    font-size: 1.1em;
                }}
                .api-grid {{
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 20px;
                    margin-top: 30px;
                }}
                .api-card {{
                    background: #f8f9fa;
                    padding: 20px;
                    border-radius: 10px;
                    border-left: 4px solid #3498db;
                    transition: transform 0.2s;
                }}
                .api-card:hover {{
                    transform: translateY(-5px);
                    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                }}
                .api-card h3 {{
                    color: #2c3e50;
                    margin: 0 0 10px 0;
                }}
                .api-card p {{
                    color: #7f8c8d;
                    margin: 5px 0;
                }}
                .api-card a {{
                    color: #3498db;
                    text-decoration: none;
                    font-weight: 500;
                }}
                .api-card a:hover {{
                    text-decoration: underline;
                }}
                .status {{
                    background: #e8f5e8;
                    padding: 15px;
                    border-radius: 10px;
                    margin: 20px 0;
                    border-left: 4px solid #27ae60;
                }}
                .demo-section {{
                    margin-top: 30px;
                    padding: 20px;
                    background: #f1f2f6;
                    border-radius: 10px;
                }}
                .demo-button {{
                    background: #3498db;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 5px;
                    cursor: pointer;
                    margin: 5px;
                    font-size: 14px;
                    transition: background 0.2s;
                }}
                .demo-button:hover {{
                    background: #2980b9;
                }}
                .demo-result {{
                    margin-top: 15px;
                    padding: 15px;
                    background: white;
                    border-radius: 5px;
                    border: 1px solid #ddd;
                    font-family: monospace;
                    white-space: pre-wrap;
                }}
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <h1>üöÄ Modern FastAPI App</h1>
                    <div class="subtitle">A stylish web application with interactive features</div>
                </div>
                
                <div class="status">
                    <strong>Status:</strong> ‚úÖ Service Running<br>
                    <strong>Time:</strong> {current_time}<br>
                    <strong>Service:</strong> hello-fastapi
                </div>

                <div class="api-grid">
                    <div class="api-card">
                        <h3>üè† Home</h3>
                        <p>Welcome page with API overview</p>
                        <a href="/">GET /</a>
                    </div>
                    <div class="api-card">
                        <h3>üíì Health Check</h3>
                        <p>Service health and status information</p>
                        <a href="/health">GET /health</a>
                    </div>
                    <div class="api-card">
                        <h3>üßÆ Calculator</h3>
                        <p>Add two numbers together</p>
                        <a href="/api/add/15/25">GET /api/add/15/25</a>
                    </div>
                    <div class="api-card">
                        <h3>üé≤ Random Number</h3>
                        <p>Generate a random number in range</p>
                        <a href="/api/random?min=1&max=100">GET /api/random?min=1&max=100</a>
                    </div>
                    <div class="api-card">
                        <h3>üìä Statistics</h3>
                        <p>Get app statistics and metrics</p>
                        <a href="/api/stats">GET /api/stats</a>
                    </div>
                    <div class="api-card">
                        <h3>üîß API Docs</h3>
                        <p>Interactive API documentation</p>
                        <a href="/docs">GET /docs</a>
                    </div>
                </div>

                <div class="demo-section">
                    <h3>üéÆ Interactive Demo</h3>
                    <p>Test the API endpoints directly:</p>
                    <button class="demo-button" onclick="testAPI('/health')">Test Health</button>
                    <button class="demo-button" onclick="testAPI('/api/add/42/8')">Test Calculator</button>
                    <button class="demo-button" onclick="testAPI('/api/random?min=1&max=10')">Test Random</button>
                    <button class="demo-button" onclick="testAPI('/api/stats')">Test Stats</button>
                    <div id="demo-result" class="demo-result" style="display: none;"></div>
                </div>
            </div>

            <script>
                async function testAPI(endpoint) {{
                    const resultDiv = document.getElementById('demo-result');
                    resultDiv.style.display = 'block';
                    resultDiv.textContent = 'Loading...';
                    
                    try {{
                        const response = await fetch(endpoint);
                        const data = await response.json();
                        resultDiv.textContent = JSON.stringify(data, null, 2);
                    }} catch (error) {{
                        resultDiv.textContent = 'Error: ' + error.message;
                    }}
                }}
            </script>
        </body>
        </html>
        """

    @app.get("/health")
    async def health():
        return {
            "status": "healthy",
            "service": "hello-fastapi",
            "timestamp": datetime.now().isoformat(),
            "uptime": "running"
        }

    @app.get("/api/add/{a}/{b}")
    async def add_numbers(a: int, b: int):
        result = a + b
        return {
            "operation": "addition",
            "inputs": {"a": a, "b": b},
            "result": result,
            "timestamp": datetime.now().isoformat()
        }

    @app.get("/api/random")
    async def get_random(min: int = 1, max: int = 100):
        import random
        if min >= max:
            raise HTTPException(status_code=400, detail="min must be less than max")
        
        number = random.randint(min, max)
        return {
            "random_number": number,
            "range": {"min": min, "max": max},
            "timestamp": datetime.now().isoformat()
        }

    @app.get("/api/stats")
    async def get_stats():
        return {
            "app_name": "Modern FastAPI App",
            "version": "1.0.0",
            "framework": "FastAPI",
            "python_version": "3.x",
            "endpoints": 6,
            "status": "active",
            "timestamp": datetime.now().isoformat()
        }

    return app

async def setup():
    # Registering FastAPI app
    fastapi_app = create_fastapi_app()

    async def serve_fastapi(args):
        await fastapi_app(args["scope"], args["receive"], args["send"])

    await api.register_service({
        "id": "hello-fastapi",
        "type": "asgi",
        "serve": serve_fastapi,
        "config": {
            "visibility": "public"
        }
    }, {"overwrite": True})

api.export({"setup": setup})
</script> 